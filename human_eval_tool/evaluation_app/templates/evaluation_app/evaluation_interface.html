{% extends 'evaluation_app/base.html' %}

{% block content %}
<div
    style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ccc; padding-bottom: 10px; margin-bottom: 20px;">
    <h2 style="margin: 0; color: var(--cmu-red);">Case #{{ origin.uid }}</h2>
    <span style="font-weight: bold; color: var(--cmu-gray);">Evaluator: {{ request.session.evaluator_id }}</span>
</div>

<!-- Origin Data Display (Blind) -->
<div style="background-color: #f9f9f9; padding: 20px; border-left: 5px solid var(--cmu-black); margin-bottom: 30px;">
    <h3 style="margin-top: 0;">Incident Narrative</h3>
    <div
        style="font-size: 1.1rem; line-height: 1.6; white-space: pre-wrap; background: white; padding: 15px; border: 1px solid #ddd;">
        {{ origin.narrative }}</div>

    <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
        <div><strong>Date:</strong> {{ origin.date }}</div>
        <div><strong>Phase:</strong> {{ origin.phase }}</div>
        <div><strong>Aircraft:</strong> {{ origin.aircraft_type }}</div>
        <div><strong>Location:</strong> {{ origin.location }}</div>
        <div><strong>Operator:</strong> {{ origin.operator }}</div>
    </div>
</div>

<!-- Evaluation Form -->
<form method="post" action="{% url 'evaluate' %}">
    {% csrf_token %}
    <input type="hidden" name="classification_result_id" value="{{ classification_result_id }}">

    <div class="form-group">
        <label for="id_category">ICAO Category Classification</label>
        <select id="id_category" name="human_category" required style="width: 100%;">
            <option value="">Search and select a category...</option>
            {% for code, data in categories.items %}
            <option value="{{ code }}">[{{ code }}] - {{ data.name }}: {{ data.description|truncatechars:80 }}</option>
            {% endfor %}
        </select>
        <small style="color: #666; display: block; margin-top: 5px;">Type to search by code, name, or
            description.</small>
    </div>

    <div class="form-group">
        <label for="id_confidence">Confidence (0.00 - 1.00)</label>
        <input type="number" id="id_confidence" name="human_confidence" min="0.00" max="1.00" step="0.01" required
            placeholder="e.g. 0.95">
    </div>

    <div class="form-group">
        <label for="id_reasoning">Reasoning</label>
        <textarea id="id_reasoning" name="human_reasoning" rows="4" required
            placeholder="Explain why you chose this category based on the narrative..."></textarea>
    </div>

    <div style="text-align: right;">
        <button type="submit" class="btn">Submit Evaluation</button>
    </div>
</form>

{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function () {
        $('#id_category').select2({
            placeholder: "Select a category",
            allowClear: true
        });
    });
</script>
{% endblock %}